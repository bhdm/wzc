{% extends "WzcMainBundle::layout.html.twig" %}


{% block header %}
    <title>{{ page.title }}</title>
    <META NAME="Keywords" CONTENT="{{ page.keywords | raw}}">
    <META NAME="Description" CONTENT="{{ page.description  | raw }}">
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .content{
            padding: 50px 0 30px 0;
            width: 900px;
            margin: 0 auto;
        }
        h1{
            color: #920055;
            font-size: 30px;
            text-transform: uppercase;
        }
        input.styler{
            width: 440px;
        }
        .table{
            width: 600px;
            margin: 0 auto ;
        }
        #map{
            border: 1px solid #920055;
            border-radius: 5px;
            padding: 3px;
        }
        .jq-selectbox__dropdown{
            z-index: 50;
            text-align: left;
        }
        #searchmap::-webkit-input-placeholder, textarea::-webkit-input-placeholder {
            color: #cccccc;
        }
        #searchmap:-moz-placeholder, textarea:-moz-placeholder {
            color: #cccccc;
        }
    </style>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="http://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>

    <script type="text/javascript">
        ymaps.ready(init);
        var myMap,
                myPlacemark;

        function init(){
            myMap = new ymaps.Map("map", {
                {% if thisMetro is defined and thisMetro != null %}
                    center: [{{ thisMetro.longitude }}, {{ thisMetro.latitude }}],
                    zoom: 14,
                {% else %}
                    center: [{{ ipCity.lat }}, {{ ipCity.lon }}],
                    zoom: 10,
                {% endif %}
                controls: ['default']
            });

//            myMap.controls.remove('geolocationControl');
            myMap.controls.add('geolocationControl');
            myMap.controls.remove('fullscreenControl');
            myMap.controls.remove('searchControl');
            myMap.controls.remove('trafficControl');
            myMap.controls.remove('rulerControl');

//            var myListBox = new ymaps.control.ListBox({
//                data: {
//                    content: 'Выбрать город'
//                },
//                items: [
//                    new ymaps.control.ListBoxItem('Москва'),
//                    new ymaps.control.ListBoxItem('Санкт-Петербург')
//                ]
//            });

            {% for c in coords %}
                myPlacemark = new ymaps.Placemark([{{ c.latitude }}, {{ c.longitude }}], {
                    {#iconContent: '{{ c.phone }}',#}
                    hintContent: '{{ c.title }} {{ c.phone }}',
                    balloonContent: '<div><b>{{ c.title | raw }}</b><br /><b>Адрес:</b> {{ c.adrs | raw }}<br /><b>Телефон:</b> {{ c.phone | raw }}<br />{{ c.body | raw }}</div>',
                },{
                    iconLayout: 'default#image',
                    iconImageHref: '{{ asset('bundles/wzcmain/images/icoHospital.png') }}',
                    iconImageSize: [24, 24],
                    iconImageOffset: [-12, -12]
//                    preset: 'islands#redSmallPoint',
//                    iconColor: '#920055'
                });
                myMap.geoObjects.add(myPlacemark);
            {% endfor %}
        }



        $(document).ready(function(){
            $('.changeMetro').change(function(){
                var url = Routing.generate('map', { thisMetro: $('#changeMetro').val() });
                window.location.href = url;
                return false;
            });

            $('#searchbtn').click(function(){
                window.location.href = '?s='+$('#searchmap').val();
            });
        });

    </script>

{% endblock %}

{% block content %}
    <div class="content">
        <h1>{{ page.title  | raw }}</h1>
        <br />
        <div style="text-align: center">
            {% spaceless %}
                <table class="table">
                    <tr>
                        <td colspan="2" style="text-align: left">
                            {% if ipRegion.iso == 'RU-MOW' %}
                                <select class="changeMetro" id="changeMetro">
                                        <option value="0">Выберите метро</option>
                                    {% for m in metro %}
                                        {% if thisMetro is defined and thisMetro != null and thisMetro != 0 %}
                                            <option value="{{ m.id }}" {{ m.id == thisMetro.id ? 'selected="selected"' : '' }}>{{ m.title }}</option>
                                        {% else %}
                                            <option value="{{ m.id }}" >{{ m.title }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </select>
                                &nbsp;
                                &nbsp;
                                &nbsp;
                            {% endif %}
                            <input type="text" name="searchmap" id="searchmap" value="" class="styler" placeholder="Поиск по названию" data-placeholder="Поиск по названию"/>
                            &nbsp;
                            &nbsp;
                            &nbsp;
                            <button class="styler" id="searchbtn">Найти</button>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2"><br /></td>
                    </tr>
                    {#<tr>#}
                        {#<td>#}
                            {#Выберите город:#}
                            {#<select id="city">#}
                                {#<option value="1">Москва</option>#}
                                {#<option value="2">Санкт-Петербург</option>#}
                            {#</select>#}
                        {#</td>#}
                        {#<td>#}
                            {#<div style="float: right">#}
                                {#Найти по метро:#}
                                {#<select>#}
                                    {#<option>Москва</option>#}
                                    {#<option>Санкт-Петербург</option>#}
                                {#</select>#}
                            {#</div>#}
                        {#</td>#}
                    {#</tr>#}
                    {#<tr>#}
                        {#<td colspan="2"><br /></td>#}
                    {#</tr>#}
                    <tr>
                        <td colspan="2">
                            <div id="map" style="width: 850px; height: 400px"></div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" style="">
                            <br />
                            <br />
                            <a href="{{ asset('bundles/wzcmain/images/blank.png') }}" target="_blank" style="color: #920055; text-decoration: underline; font-weight: bold;">Распечатать бланк направления</a>
                            <br />
                            <br />
                            Пожалуйста, не забудьте вместе с бланком взять на прием паспорт и страховой полис. В большинстве клиник Вас ждет бесплатный прием
                            <br />
                            <br />
                            <div style="text-align: left">
                                {{ page.body  | raw }}
                            </div>
                        </td>
                    </tr>
                </table>
                <br />
            {% endspaceless %}
        </div>
        <div class="cell25">

        </div>
        <div class="cell33" id="metro">

        </div>

        <br style="clear: both"/>
    </div>
{% endblock %}